# 语法专题

## 数据类型的转换

 如果运算符发现，运算子的类型与预期不符，就会自动转换类型。 

 **强制转换**主要指使用`Number()`、`String()`和`Boolean()`三个函数，手动将各种类型的值，分别转换成数字、字符串或者布尔值。 

##### `Number()`

 `Number`函数将字符串转为数值，要比`parseInt`函数严格很多。基本上，只要有一个字符无法转成数值，整个字符串就会被转为`NaN`。 `parseInt`逐个解析字符，而`Number`函数整体转换字符串的类型。另外，`parseInt`和`Number`函数都会**自动过滤一个字符串前导和后缀的空格。**

 `Number`方法的参数是**对象**时，将返回`NaN`，除非是包含单个数值的数组。 

##### `String()`

 `String`函数可以将任意类型的值转化成字符串 。

- **数值**：转为相应的字符串。
- **字符串**：转换后还是原来的值。
- **布尔值**：`true`转为字符串`"true"`，`false`转为字符串`"false"`。
- **undefined**：转为字符串`"undefined"`。
- **null**：转为字符串`"null"`。

 `String`方法的参数如果是**对象**，返回一个**类型字符串**；如果是数组，返回该数组的字符串形式。 

##### `Boolean()`

 `Boolean()`函数可以将任意类型的值转为布尔值。 

 除了以下五个值的转换结果为`false`，其他的值全部为`true`。 

- `undefined`
- `null`
- `0`（包含`-0`和`+0`）
- `NaN`
- `''`（空字符串）

 **所有对象（包括空对象）的转换结果都是`true`，甚至连`false`对应的布尔对象`new Boolean(false)`也是`true`** 



 以下三种情况时，JavaScript 会自动转换数据类型，即转换是自动完成的，用户不可见：

 第一种情况，不同类型的数据互相运算。 

 第二种情况，对非布尔值类型的数据求布尔值。 

 第三种情况，对非数值类型的值使用一元运算符（即`+`和`-`）。 

 **注意：`null`转为数值时为`0`，而`undefined`转为数值时为`NaN`。** 

## 错误处理机制

 JavaScript 原生提供`Error`构造函数，所有抛出的错误都是这个构造函数的实例。  `Error`实例对象必须有`message`属性，表示出错时的提示信息，没有提到其他属性。大多数 JavaScript 引擎，对`Error`实例还提供`name`和`stack`属性，分别表示错误的名称和错误的堆栈，但它们是非标准的，不是每种实现都有。 

- **message**：错误提示信息
- **name**：错误名称（非标准属性）
- **stack**：错误的堆栈（非标准属性）

 `Error`实例对象是最一般的错误类型，在它的基础上，JavaScript 还定义了其他6种错误对象。也就是说，存在`Error`的6个派生对象。 

 `SyntaxError`对象是解析代码时发生的**语法错误。** 

 `ReferenceError`对象是引用一个**不存在的变量**时发生的错误。 

 `RangeError`对象是一个值**超出有效范围**时发生的错误。 

 `TypeError`对象是变量或参数**不是预期类型**时发生的错误。 

 `URIError`对象是 **URI 相关函数**的参数不正确时抛出的错误，主要涉及`encodeURI()`、`decodeURI()`、`encodeURIComponent()`、`decodeURIComponent()`、`escape()`和`unescape()`这六个函数。 

 `eval`函数没有被正确执行时，会抛出`EvalError`错误。 

 `throw`语句的作用是**手动中断程**序执行，抛出一个错误。 

 `try...catch`结构，允许对错误进行处理，选择是否往下执行。 如果try报错，就会执行catch里的代码块，接着对错误进行处理。 `try...catch`结构允许在最后添加一个`finally`代码块，表示不管是否出现错误，都必需在最后运行的语句。 

## 编程风格

 “编程风格”（programming style）指的是编写代码的样式规则。不同的程序员，往往有不同的编程风格。 

 **必须牢记的一点是，如果你选定了一种“编程风格”，就应该坚持遵守，切忌多种风格混用。如果你加入他人的项目，就应该遵守现有的风格。** 

 圆括号（parentheses）在 JavaScript 中有两种作用，一种表示**函数的调用**，另一种表示表达式的组合（grouping）。 

1. 表示函数调用时，函数名与左括号之间没有空格。
2. 表示函数定义时，函数名与左括号之间没有空格。
3. 其他情况时，前面位置的语法元素与左括号之间，都有一个空格。

 注意，**函数表达式**仍然要使用分号。 

```
var f = function f() {
};
```

 只有下一行的开始与本行的结尾，无法放在一起解释，JavaScript 引擎才会自动添加分号。 

 JavaScript 会自动将变量声明“提升”（hoist）到代码块（block）的**头部**。 

 `with`可以减少代码的书写，但是会造成混淆。  因此，不要使用`with`语句。 

 因此，建议不要使用相等运算符（`==`），只使用严格相等运算符（`===`）。 

## console对象与控制台

`console`的常见用途有两个。

- 调试程序，显示网页代码运行时的错误信息。
- 提供了一个命令行接口，用来与网页代码互动。

 `Console`面板基本上就是一个命令行窗口，你可以在提示符下，键入各种命令。 

 `console.log`方法用于在**控制台输出信息**。它可以接受一个或多个参数，将它们连接起来输出。 

`console.log`方法支持以下占位符，不同类型的数据必须使用对应的占位符。

- `%s` 字符串
- `%d` 整数
- `%i` 整数
- `%f` 浮点数
- `%o` 对象的链接
- `%c` CSS 格式字符串

 `warn`方法输出信息时，在最前面加一个**黄色三角，表示警告**；`error`方法输出信息时，在最前面加一个**红色的叉，表示出错**。同时，还会高亮显示输出文字和错误发生的堆栈。其他方面都一样。 

 `log`方法是写入标准输出（`stdout`），`warn`方法和`error`方法是**写入标准错误**（`stderr`）。 

 对于某些复合类型的数据，`console.table`方法可以将其转为**表格**显示。 

 `count`方法用于计数，输出它被**调用了多少次**。 

 `dir`方法用来**对一个对象进行检查**（inspect），并以易于阅读和打印的格式显示。  Node 环境之中，还可以指定以代码高亮的形式输出。 

 `dirxml`方法主要用于以目录树的形式  ，显示 DOM 节点。  如果参数不是 DOM 节点，而是普通的 JavaScript 对象，`console.dirxml`等同于`console.dir`。 

 `console.assert`方法主要用于程序运行过程中，**进行条件判断**，如果不满足条件，就显示一个错误，但不会中断程序执行。这样就相当于提示用户，内部状态不正确。 

 这两个方法用于计时，可以**算出一个操作所花费的准确时间**。  `time`方法表示计时开始，`timeEnd`方法表示计时结束。 

 `console.group`和`console.groupEnd`这两个方法用于**将显示的信息分组**。它只在输出大量信息时有用，分在一组的信息，可以用鼠标折叠/展开。 

 `console.groupCollapsed`方法与`console.group`方法很类似，唯一的区别是该组的内容，在第一次显示时是收起的（collapsed），而不是展开的。 

 `console.trace`方法显示当前执行的代码在堆栈中的**调用路径**。 

 `console.clear`方法用于**清除当前控制台的所有输出**，将光标回置到第一行。 

 浏览器控制台中，除了使用`console`对象，还可以使用一些**控制台自带的命令行方法**。 

# 标准库

## Array对象

 `Array`是 JavaScript 的原生对象，同时也是一个构造函数，可以用它生成新的数组。 

### 静态方法

 `Array.isArray`方法返回一个布尔值，表示参数是否为数组。它可以弥补`typeof`运算符的不足。 

### 实例方法

 `valueOf`方法是一个所有对象都拥有的方法，表示对该对象求值。不同对象的`valueOf`方法不尽一致，数组的`valueOf`方法返回数组本身。 

 `toString`方法也是对象的通用方法，数组的`toString`方法返回数组的字符串形式。 

 `push`方法用于在数组的末端添加一个或多个元素，并返回添加新元素后的数组长度。**注意，该方法会改变原数组。** 

 `pop`方法用于删除数组的最后一个元素，并返回该元素。**注意，该方法会改变原数组。** 

 `shift()`方法用于删除数组的第一个元素，并返回该元素。**注意，该方法会改变原数组。** 

 `unshift()`方法用于在数组的第一个位置添加元素，并返回添加新元素后的数组长度。**注意，该方法会改变原数组。** 

 `join()`方法以指定参数作为分隔符，将所有数组成员连接为一个字符串返回。  如果数组成员是`undefined`或`null`或空位，会被转成空字符串。  `concat`方法用于多个数组的合并。它将新数组的成员，添加到原数组成员的后部，然后返回一个新数组，**原数组不变。** 

 `reverse`方法用于颠倒排列数组元素，返回改变后的数组。**注意，该方法将改变原数组。** 

 `slice()`方法用于提取目标数组的一部分，返回一个新数组，**原数组不变。** 

 `splice()`方法用于删除原数组的一部分成员，并可以在删除的位置添加新的数组成员，返回值是被删除的元素。**注意，该方法会改变原数组。**  第一个参数是删除的起始位置（从0开始），第二个参数是被删除的元素个数。如果后面还有更多的参数，则表示这些就是要被插入数组的新元素。 

 `sort`方法对数组成员进行排序，默认是按照字典顺序排序。排序后，**原数组将被改变。** 

 `map`方法将数组的所有成员依次传入参数函数，然后把每一次的执行结果**组成一个新数组返回**。  `map`方法接受一个函数作为参数。该函数调用时，`map`方法向它传入三个参数：当前成员、当前位置和数组本身。 

 这就是说，如果数组遍历的目的是为了得到返回值，那么使用`map`方法，否则使用`forEach`方法。 

 `filter`方法用于过滤数组成员，满足条件的成员组成一个新数组返回。  `filter`方法还可以接受第二个参数，用来绑定参数函数内部的`this`变量。 

 `some`方法是**只要一个成员的返回值是`true`**，则整个`some`方法的返回值就是`true`，否则返回`false`。 

 `every`方法是所有成员的返回值都是`true`，整个`every`方法才返回`true`，否则返回`false`。 

 `reduce`方法和`reduceRight`方法依次处理数组的每个成员，**最终累计为一个值**。它们的差别是，`reduce`是从**左到右**处理（从第一个成员到最后一个成员），`reduceRight`则是**从右到左**（从最后一个成员到第一个成员），其他完全一样。 

 `indexOf`方法返回给定元素在数组中**第一次出**现的位置，如果没有出现则返回`-1`。  `indexOf`方法还可以接受第二个参数，表示搜索的开始位置。 

`lastIndexOf`方法返回给定元素在数组中**最后一次**出现的位置，如果没有出现则返回`-1`。

 **注意，**这两个方法不能用来搜索`NaN`的位置，即它们无法确定数组成员是否包含`NaN`。 

## date对象

 `Date`对象是 JavaScript 原生的时间库。它以国际标准时间（UTC）1970年1月1日00:00:00作为时间的零点，可以表示的时间范围是前后各1亿天（单位为毫秒）。 

 注意，即使带有参数，`Date`作为**普通函数**使用时，返回的还是当前时间。 默认调用toString()方法，返回的是字符串。

 作为**构造函数**时，`Date`对象可以接受多种格式的参数，返回一个该参数对应的时间实例。 

- 年：使用四位数年份，比如`2000`。如果写成两位数或个位数，则加上`1900`，即`10`代表1910年。如果是负数，表示公元前。
- 月：`0`表示一月，依次类推，`11`表示12月。
- 日：`1`到`31`。
- 小时：`0`到`23`。
- 分钟：`0`到`59`。
- 秒：`0`到`59`
- 毫秒：`0`到`999`。

 `Date`实例如果转为数值，则等于对应的毫秒数；如果转为字符串，则等于对应的日期字符串。 

### 静态方法

 `Date.now`方法返回**当前时间**距离时间零点（1970年1月1日 00:00:00 UTC）的毫秒数，相当于 Unix 时间戳乘以1000。 

 `Date.parse`方法用来解析日期字符串，返回该时间距离时间零点（1970年1月1日 00:00:00）的毫秒数。 

 **日期字符串应该符合 RFC 2822 和 ISO 8061 这两个标准，即`YYYY-MM-DDTHH:mm:ss.sssZ`格式，其中最后的`Z`表示时区** 

 `Date.UTC`方法接受年、月、日等变量作为参数，返回该时间距离时间零点（1970年1月1日 00:00:00 UTC）的毫秒数。 

### 实例方法				

`Date`的实例对象，有几十个自己的方法，除了`valueOf`和`toString`，可以分为以下三类。

- `to`类：从`Date`对象返回一个字符串，表示指定的时间。
- `get`类：获取`Date`对象的日期和时间。
- `set`类：设置`Date`对象的日期和时间。

 `valueOf`方法返回实例对象距离时间零点（1970年1月1日00:00:00 UTC）对应的毫秒数，该方法等同于`getTime`方法。 

#### to类

 `toString`方法返回一个完整的日期字符串。 

 `toUTCString`方法返回对应的 UTC 时间，也就是比北京时间晚8个小时。 

 `toISOString`方法返回对应时间的 ISO8601 写法。 

 `toJSON`方法返回一个符合 JSON 格式的 ISO 日期字符串，与`toISOString`方法的返回结果完全相同。 

 `toDateString`方法返回日期字符串（不含小时、分和秒）。 

 `toTimeString`方法返回时间字符串（不含年月日）。 

 以下三种方法，可以将 Date **实例转为表示本地时间的字符串**：

- `Date.prototype.toLocaleString()`：完整的本地时间。
- `Date.prototype.toLocaleDateString()`：本地日期（不含小时、分和秒）。
- `Date.prototype.toLocaleTimeString()`：本地时间（不含年月日）。

#### get类

`Date`对象提供了一系列`get*`方法，用来获取实例对象某个方面的值。

- `getTime()`：返回实例距离1970年1月1日00:00:00的毫秒数，等同于`valueOf`方法。
- `getDate()`：返回实例对象对应每个月的几号（从1开始）。
- `getDay()`：返回星期几，星期日为0，星期一为1，以此类推。
- `getFullYear()`：返回四位的年份。
- `getMonth()`：返回月份（0表示1月，11表示12月）。
- `getHours()`：返回小时（0-23）。
- `getMilliseconds()`：返回毫秒（0-999）。
- `getMinutes()`：返回分钟（0-59）。
- `getSeconds()`：返回秒（0-59）。
- `getTimezoneOffset()`：返回当前时间与 UTC 的时区差异，以分钟表示，返回结果考虑到了夏令时因素。

#### set类

Date`对象提供了一系列`set*`方法，用来设置实例对象的各个方面。

- `setDate(date)`：设置实例对象对应的每个月的几号（1-31），返回改变后毫秒时间戳。
- `setFullYear(year [, month, date])`：设置四位年份。
- `setHours(hour [, min, sec, ms])`：设置小时（0-23）。
- `setMilliseconds()`：设置毫秒（0-999）。
- `setMinutes(min [, sec, ms])`：设置分钟（0-59）。
- `setMonth(month [, date])`：设置月份（0-11）。
- `setSeconds(sec [, ms])`：设置秒（0-59）。
- `setTime(milliseconds)`：设置毫秒时间戳。

## RegExp对象

 `RegExp`对象提供正则表达式的功能 

 正则表达式（regular expression）是一种表达文本模式（即字符串结构）的方法，有点像字符串的模板，常常用来按照“给定模式”匹配文本。比如，正则表达式给出一个 Email 地址的模式，然后用它来确定一个字符串是否为 Email 地址。 

 **新建正则表达式有两种方法**：

一种是使用字面量，以斜杠表示开始和结束。

  另一种是使用`RegExp`构造函数 

 `RegExp`构造函数还可以接受第二个参数，表示修饰符 

### 实例属性

 正则对象的**实例属性**分成两类：

 一类是修饰符相关，用于了解设置了什么修饰符。 

- `RegExp.prototype.ignoreCase`：返回一个布尔值，表示是否设置了`i`修饰符。
- `RegExp.prototype.global`：返回一个布尔值，表示是否设置了`g`修饰符。
- `RegExp.prototype.multiline`：返回一个布尔值，表示是否设置了`m`修饰符。
- `RegExp.prototype.flags`：返回一个字符串，包含了已经设置的所有修饰符，按字母排序。

 上面四个属性都是**只读**的。 

 另一类是与修饰符无关的属性，主要是下面两个：

- `RegExp.prototype.lastIndex`：返回一个整数，表示下一次开始搜索的位置。该属性可读写，但是只在进行连续搜索时有意义，详细介绍请看后文。
- `RegExp.prototype.source`：返回正则表达式的字符串形式（不包括反斜杠），该属性只读。

### 实例方法

 正则实例对象的`test`方法返回一个布尔值，表示**当前模式是否能匹配参数字符串**。  如果正则表达式带有`g`修饰符，则每一次`test`方法都从上一次结束的位置开始向后匹配。  可以通过正则对象的`lastIndex`属性指定开始搜索的位置。 

 正则实例对象的`exec()`方法，用来**返回匹配结果**。 

字符串的实例方法之中，有4种与正则表达式有关。

- `String.prototype.match()`：返回一个数组，成员是所有匹配的子字符串。
- `String.prototype.search()`：按照给定的正则表达式进行搜索，返回一个整数，表示匹配开始的位置。
- `String.prototype.replace()`：按照给定的正则表达式进行替换，返回替换后的字符串。
- `String.prototype.split()`：按照给定规则进行字符串分割，返回一个数组，包含分割后的各个成员。